// Underscore-Awesomer.js 1.0.0
// (c) 2011 Kevin Malakoff.
// Underscore-Awesomer is freely distributable under the MIT license.
// Underscore-Awesomer are extensions to the Underscore library: http://documentcloud.github.com/underscore
// https://github.com/kmalakoff/underscore-awesomer
//
// Note: some code from Underscore.js is repeated in this file.
// Please see the following for details on Underscore.js and its licensing:
// https://github.com/documentcloud/underscore
// https://github.com/documentcloud/underscore/blob/master/LICENSE
(function(){function o(a,c,d){if(a===c)return a!==0||1/a==1/c;if(a==null||c==null)return a===c;if(a._chain)a=a._wrapped;if(c._chain)c=c._wrapped;if(b.isFunction(a.isEqual))return a.isEqual(c);if(b.isFunction(c.isEqual))return c.isEqual(a);var e=typeof a;if(e!=typeof c)return!1;if(!a!=!c)return!1;if(b.isNaN(a))return b.isNaN(c);var f=b.isString(a),g=b.isString(c);if(f||g)return f&&g&&String(a)==String(c);f=b.isNumber(a);g=b.isNumber(c);if(f||g)return f&&g&&+a==+c;f=b.isBoolean(a);g=b.isBoolean(c);
if(f||g)return f&&g&&+a==+c;f=b.isDate(a);g=b.isDate(c);if(f||g)return f&&g&&a.getTime()==c.getTime();f=b.isRegExp(a);g=b.isRegExp(c);if(f||g)return f&&g&&a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase;if(e!="object")return!1;for(e=d.length;e--;)if(d[e]==a)return!0;d.push(a);e=0;f=!0;if(a.length===+a.length||c.length===+c.length){if(f=a instanceof c.constructor||c instanceof a.constructor)if(e=a.length,f=e==c.length)for(;e--;)if(!(f=e in a==e in c&&o(a[e],
c[e],d)))break}else{for(var j in a)if(hasOwnProperty.call(a,j)&&(e++,!(f=hasOwnProperty.call(c,j)&&o(a[j],c[j],d))))break;if(f){for(j in c)if(hasOwnProperty.call(c,j)&&!e--)break;f=!e}}d.pop();return f}var n=this;if(!n._)throw Error("Underscore-Awesomer.js requires Underscore.js...please include it before this file.");var b=n._;b.AWESOMENESS="1.0.0";b.pluck=function(a,c,d){return d?b.map(a,function(a){var b=a[c];delete a[c];return b}):b.map(a,function(a){return a[c]})};b.isEqual=function(a,b){return o(a,
b,[])};b.remove=function(a,c,d){if(b.isEmpty(a))return!c||b.isFunction(c)?[]:void 0;d||(d={});b.isFunction(d)&&(d={callback:d});var e;if(d.preclear){var f=a,a=b.clone(a);if(b.isArray(f))f.length=0;else for(e in f)delete f[e]}var g=[],j,h,k,f=!1;if(b.isArray(a)){if(b.isUndefined(c))g=b.keys(a);else if(b.isFunction(c))d.first_only?(f=!0,b.find(a,function(a,b){return c(a)?(g.push(b),!0):!1})):b.each(a,function(a,b){c(a)&&g.push(b)});else if(b.isArray(c))if(d.first_only){f=!0;for(h=c.length-1;h>=0;h--)j=
c[h],b.find(a,function(a,b){return j===a?(g.push(b),!0):!1})}else for(h=c.length-1;h>=0;h--)j=c[h],b.each(a,function(a,b){j===a&&g.push(b)});else d.first_only?(f=!0,h=b.indexOf(a,c),h>=0&&g.push(h)):(f=!0,b.each(a,function(a,b){c===a&&g.push(b)}));if(f){if(g.length){f=0;e=a[g[0]];for(g=g.sort(function(a,c){return b.compare(a,c)});g.length;)f++,a.splice(g.pop(),1);if(d.callback)for(;f>0;)d.callback(e),f--;return e}}else if(g.length){e=[];for(g=g.sort(function(a,c){return b.compare(a,c)});g.length;)f=
g.pop(),e.unshift(a[f]),a.splice(f,1);d.callback&&b.each(e,function(a){d.callback(a)});return b.uniq(e)}else return[]}else{var m;if(b.isUndefined(c))g=b.keys(a);else if(b.isFunction(c))for(e in a)c(a[e],e)&&g.push(e);else if(b.isArray(c))if(d.values)for(h=0,k=c.length;h<k;h++)if(j=c[h],d.first_only)for(e in a){if(j===a[e]){g.push(e);break}}else for(e in a)j===a[e]&&g.push(e);else{m=c;for(h=0,k=c.length;h<k;h++)e=c[h],a.hasOwnProperty(e)&&g.push(e)}else if(b.isString(c)&&!d.values)f=!0,m=[],a.hasOwnProperty(c)&&
(m.push(c),g.push(c));else for(e in a)c===a[e]&&g.push(e);if(m)if(m.length){for(h=[];g.length;)e=g.shift(),h.push(a[e]),delete a[e];d.callback&&b.each(h,function(a,b){d.callback(a,m[b])});return f?h[0]:h}else return f?void 0:[];else if(g.length){for(h={};g.length;)e=g.shift(),h[e]=a[e],delete a[e];d.callback&&b.each(h,function(a,b){d.callback(a,b)});return h}else return{}}};b.findIndex=function(a,b){for(i=0,l=a.length;i<l;i++)if(b(a[i]))return i;return-1};b.hasKeypath=b.keypathExists=function(a,c){return!!b.keypathValueOwner(a,
c)};b.keypathValueOwner=function(a,c){var d=b.isString(c)?c.split("."):c;if(d.length===1)return a instanceof Object&&c in a?a:void 0;for(var e,f=a,g=0,j=d.length;g<j;){e=d[g];if(!(e in f))break;if(++g===j)return f;f=f[e];if(!f||!(f instanceof Object))break}};b.keypath=function(a,c,d){c=b.isString(c)?c.split("."):c;a=b.keypathValueOwner(a,c);if(b.isUndefined(d))return!a?void 0:a[c[c.length-1]];else if(a)return a[c[c.length-1]]=d,a[c[c.length-1]]};b.cloneToDepth=b.clone=function(a,c){var d=b.isArray(a)?
a.slice():b.extend({},a);if(!b.isUndefined(c)&&c>0){var e,f;for(f in d)e=d[f],d[f]=typeof e==="object"?b.clone(e,c-1):e}return d};b.isConstructor=function(a){return b.isFunction(a)&&a.name};b.resolveConstructor=function(a){var c=b.isArray(a)?a:b.isString(a)?a.split("."):void 0;if(c)return(a=c.length===1?n[c[0]]:b.keypath(n,c))&&b.isConstructor(a)?a:void 0;else if(b.isFunction(a)&&b.isConstructor(a))return a};b.CONVERT_NONE=0;b.CONVERT_IS_TYPE=1;b.CONVERT_TO_METHOD=2;b.conversionPath=function(a,c){var d=
b.isArray(c)?c:b.isString(c)?c.split("."):void 0,e=typeof a,f=d?d[d.length-1]:void 0;if(d&&e===f)return b.CONVERT_IS_TYPE;if((d=b.resolveConstructor(d?d:c))&&e=="object")try{if(a instanceof d)return b.CONVERT_IS_TYPE}catch(g){}f=d&&d.name?d.name:f;if(!f)return b.CONVERT_NONE;if(b["is"+f]&&b["is"+f](a))return b.CONVERT_IS_TYPE;else if(e=="object"&&a["to"+f])return b.CONVERT_TO_METHOD;return b.CONVERT_NONE};b.isConvertible=function(a,c){return b.conversionPath(a,c)>0};b.toType=function(a,c){var d=b.isArray(c)?
c:b.isString(c)?c.split("."):void 0;switch(b.conversionPath(a,d?d:c)){case 1:return a;case 2:return d?a["to"+d[d.length-1]]():(d=b.resolveConstructor(c))&&d.name?a["to"+d.name]():void 0}};b.functionExists=function(a,c){return a instanceof Object&&a[c]&&b.isFunction(a[c])};b.callIfExists=function(a,c){return b.functionExists(a,c)?a[c].apply(a,Array.prototype.slice.call(arguments,2)):void 0};b.getSuperFunction=function(a,c){var d=b.keypathValueOwner(a,["constructor","__super__",c]);return d&&b.isFunction(d[c])?
d[c]:void 0};b.superCall=function(a,c){return b.superApply(a,c,Array.prototype.slice.call(arguments,2))};b.superApply=function(a,c,d){return(c=b.getSuperFunction(a,c))?c.apply(a,d):void 0};b.classOf=function(a){return a!=null&&Object.getPrototypeOf(Object(a)).constructor.name||void 0};b.copyProperties=function(a,c,d,e){for(var f=d||b.keys(c),g=!1,j=0,h=f.length;j<h;j++)d=f[j],hasOwnProperty.call(c,d)&&(a[d]=c[d],g=!0,e&&delete c[d]);return g};b.getValue=function(a,b,d,e){if(hasOwnProperty.call(a,
b)){if(!e)return a[b];d=a[b];delete a[b]}return d};b.sortBy=function(a,c,d){return b.pluck(b.map(a,function(a,b,g){return{value:a,criteria:c.call(d,a,b,g)}}).sort(function(a,c){return b.compare(a.criteria,c.criteria)}),"value")};b.sortedIndex=function(a,c,d){d||(d=b.identity);for(var e=0,f=a.length;e<f;){var g=e+f>>1;b.compare(d(a[g]),d(c))==b.COMPARE_ASCENDING?e=g+1:f=g}return e};b.COMPARE_EQUAL=0;b.COMPARE_ASCENDING=-1;b.COMPARE_DESCENDING=1;b.compare=function(a,c,d){if(typeof a!=="object")return a===
c?b.COMPARE_EQUAL:a<c?b.COMPARE_ASCENDING:b.COMPARE_DESCENDING;d||(d="compare");if(a[d]&&b.isFunction(a[d]))return a=a[d](c),a===0?b.COMPARE_EQUAL:a<0?b.COMPARE_ASCENDING:b.COMPARE_DESCENDING;else if(c[d]&&b.isFunction(c[d]))return a=c[d](a),a===0?b.COMPARE_EQUAL:a<0?b.COMPARE_DESCENDING:b.COMPARE_ASCENDING;return a===c?b.COMPARE_EQUAL:a<c?b.COMPARE_ASCENDING:b.COMPARE_DESCENDING};b.own=function(a,c){if(!a||typeof a!="object")return a;c||(c={});if(b.isArray(a))if(c.share_collection)b.each(a,function(a){b.own(a,
{prefer_clone:c.prefer_clone})});else{var d=[];b.each(a,function(a){d.push(b.own(a,{prefer_clone:c.prefer_clone}))});return d}else if(c.properties)if(c.share_collection)b.each(a,function(a){b.own(a,{prefer_clone:c.prefer_clone})});else{var e={};b.each(a,function(a,d){e[d]=b.own(a,{prefer_clone:c.prefer_clone})});return e}else if(a.retain)if(c.prefer_clone&&a.clone)return a.clone();else a.retain();else if(a.clone)return a.clone();return a};b.disown=function(a,c){if(!a||typeof a!="object")return a;
c||(c={});if(b.isArray(a))c.clear_values?b.each(a,function(c,e){b.disown(c);a[e]=null}):(b.each(a,function(a){b.disown(a)}),a.length=0);else if(c.properties)if(c.clear_values)b.each(a,function(c,e){b.disown(c);a[e]=null});else for(key in b.each(a,function(a){b.disown(a)}),a)delete a[key];else a.release?a.release():a.destroy&&a.destroy();return a};b.toJSON=function(a,c){if(!a||typeof a!=="object")return a;c||(c={});var d;if(b.isArray(a)){if(c.included){var e;e=c.excluded?b.difference(c.included,c.excluded):
c.included;d={};b.each(e,function(c){b.contains(a,c)&&d.push(b.toJSON(c))})}else c.excluded?(d=[],b.each(a,function(a){b.contains(c.excluded,a)||d.push(b.toJSON(a))})):(d=[],b.each(a,function(a){d.push(b.toJSON(a))}));return d}else if(a.toJSON)return a.toJSON();else if(c.properties)return c.included?(e=c.excluded?b.difference(c.included,c.excluded):c.included,d={},b.each(e,function(c){a.hasOwnProperty(c)&&(d[c]=b.toJSON(a[c]))})):c.excluded?(d={},b.each(a,function(a,e){b.contains(c.excluded,e)||(d[e]=
b.toJSON(a))})):(d={},b.each(a,function(a,c){d[c]=b.toJSON(a)})),d;return a};b.PARSE_JSON_TYPE_FIELD="_type";b.PARSE_JSON_CONSTRUCTOR_ROOTS=[n];b.parseJSON=function(a,c){var d=typeof a;if(d!=="object"&&d!=="string")return a;if(d==="string"&&a.length&&(a[0]==="{"||a[0]==="["))try{var e=JSON.parse(a);e&&(a=e)}catch(f){throw new TypeError("Unable to parse JSON: "+a);}var g;if(b.isArray(a))return g=[],b.each(a,function(a){g.push(b.parseJSON(a,j))}),g;else if(c&&c.properties)return g={},b.each(a,function(a,
c){g[c]=b.parseJSON(a,j)}),g;var j=c&&c.type_field?c.type_field:b.PARSE_JSON_TYPE_FIELD;if(!(a instanceof Object)||!a.hasOwnProperty(j))return a;for(var d=a[j],h=0,k=b.PARSE_JSON_CONSTRUCTOR_ROOTS.length;h<k;h++)if(e=b.PARSE_JSON_CONSTRUCTOR_ROOTS[h],parseJSON_owner=b.keypathValueOwner(e,d+".parseJSON"))return parseJSON_owner.parseJSON(a);throw new TypeError("Unable to find a parseJSON function for type: "+d);};b.mixin({AWESOMENESS:b.AWESOMENESS,pluck:b.pluck,isEqual:b.isEqual,remove:b.remove,findIndex:b.findIndex,
hasKeypath:b.hasKeypath,keypathExists:b.keypathExists,keypathValueOwner:b.keypathValueOwner,keypath:b.keypath,cloneToDepth:b.cloneToDepth,clone:b.clone,isConstructor:b.isConstructor,resolveConstructor:b.resolveConstructor,CONVERT_NONE:b.CONVERT_NONE,CONVERT_IS_TYPE:b.CONVERT_IS_TYPE,CONVERT_TO_METHOD:b.CONVERT_TO_METHOD,conversionPath:b.conversionPath,isConvertible:b.isConvertible,conversionPath:b.conversionPath,toType:b.toType,functionExists:b.functionExists,callIfExists:b.callIfExists,getSuperFunction:b.getSuperFunction,
superCall:b.superCall,superApply:b.superApply,classOf:b.classOf,copyProperties:b.copyProperties,getValue:b.getValue,COMPARE_EQUAL:b.COMPARE_EQUAL,COMPARE_ASCENDING:b.COMPARE_ASCENDING,COMPARE_DESCENDING:b.COMPARE_DESCENDING,compare:b.compare,own:b.own,disown:b.disown,toJSON:b.toJSON,parseJSON:b.parseJSON})})();
