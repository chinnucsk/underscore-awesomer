// Underscore-Awesomer.js 1.2.0
// (c) 2011 Kevin Malakoff.
// Underscore-Awesomer is freely distributable under the MIT license.
// Underscore-Awesomer are extensions to the Underscore library: http://documentcloud.github.com/underscore
// https://github.com/kmalakoff/underscore-awesomer
//
// Note: some code from Underscore.js is repeated in this file.
// Please see the following for details on Underscore.js and its licensing:
// https://github.com/documentcloud/underscore
// https://github.com/documentcloud/underscore/blob/master/LICENSE
(function(){var k=this;if(!k._)throw Error("Underscore-Awesomer.js requires Underscore.js...please include it before this file.");var a=k._;a.AWESOMENESS="1.2.0";a.pluck=function(b,c,d){return d?a.map(b,function(a){var b=a[c];delete a[c];return b}):a.map(b,function(a){return a[c]})};a.remove=function(b,c,d){if(a.isEmpty(b))return!c||a.isFunction(c)?[]:void 0;d||(d={});a.isFunction(d)&&(d={callback:d});var e;if(d.preclear){var g=b,b=a.clone(b);if(a.isArray(g))g.length=0;else for(e in g)delete g[e]}var f=
[],j,h,k,g=!1;if(a.isArray(b)){if(a.isUndefined(c))f=a.keys(b);else if(a.isFunction(c))d.first_only?(g=!0,a.find(b,function(a,b){return c(a)?(f.push(b),!0):!1})):a.each(b,function(a,b){c(a)&&f.push(b)});else if(a.isArray(c))if(d.first_only){g=!0;for(h=c.length-1;h>=0;h--)j=c[h],a.find(b,function(a,b){return j===a?(f.push(b),!0):!1})}else for(h=c.length-1;h>=0;h--)j=c[h],a.each(b,function(a,b){j===a&&f.push(b)});else d.first_only?(g=!0,h=a.indexOf(b,c),h>=0&&f.push(h)):(g=!0,a.each(b,function(a,b){c===
a&&f.push(b)}));if(g){if(f.length){g=0;e=b[f[0]];for(f=f.sort(function(b,c){return a.compare(b,c)});f.length;)g++,b.splice(f.pop(),1);if(d.callback)for(;g>0;)d.callback(e),g--;return e}}else if(f.length){e=[];for(f=f.sort(function(b,c){return a.compare(b,c)});f.length;)g=f.pop(),e.unshift(b[g]),b.splice(g,1);d.callback&&a.each(e,function(a){d.callback(a)});return a.uniq(e)}else return[]}else{var m;if(a.isUndefined(c))f=a.keys(b);else if(a.isFunction(c))for(e in b)c(b[e],e)&&f.push(e);else if(a.isArray(c))if(d.values)for(h=
0,k=c.length;h<k;h++)if(j=c[h],d.first_only)for(e in b){if(j===b[e]){f.push(e);break}}else for(e in b)j===b[e]&&f.push(e);else{m=c;for(h=0,k=c.length;h<k;h++)e=c[h],b.hasOwnProperty(e)&&f.push(e)}else if(a.isString(c)&&!d.values)g=!0,m=[],b.hasOwnProperty(c)&&(m.push(c),f.push(c));else for(e in b)c===b[e]&&f.push(e);if(m)if(m.length){for(h=[];f.length;)e=f.shift(),h.push(b[e]),delete b[e];d.callback&&a.each(h,function(a,b){d.callback(a,m[b])});return g?h[0]:h}else return g?void 0:[];else if(f.length){for(h=
{};f.length;)e=f.shift(),h[e]=b[e],delete b[e];d.callback&&a.each(h,function(a,b){d.callback(a,b)});return h}else return{}}};a.findIndex=function(a,c){for(i=0,l=a.length;i<l;i++)if(c(a[i]))return i;return-1};a.hasKeypath=a.keypathExists=function(b,c){return!!a.keypathValueOwner(b,c)};a.keypathValueOwner=function(b,c){var d=a.isString(c)?c.split("."):c;if(d.length===1)return b instanceof Object&&c in b?b:void 0;for(var e,g=b,f=0,j=d.length;f<j;){e=d[f];if(!(e in g))break;if(++f===j)return g;g=g[e];
if(!g||!(g instanceof Object))break}};a.keypath=function(b,c,d){c=a.isString(c)?c.split("."):c;b=a.keypathValueOwner(b,c);if(a.isUndefined(d))return!b?void 0:b[c[c.length-1]];else if(b)return b[c[c.length-1]]=d,b[c[c.length-1]]};a.cloneToDepth=a.containerClone=a.clone=function(b,c){if(!b||typeof b!=="object")return b;var d;if(a.isArray(b))d=Array.prototype.slice.call(b);else if(b.constructor!=={}.constructor)return b;else d=a.extend({},b);if(!a.isUndefined(c)&&c>0)for(var e in d)d[e]=a.clone(d[e],
c-1);return d};a.deepClone=function(b,c){if(!b||typeof b!=="object")return b;else if(a.isString(b))return String.prototype.slice.call(b);else if(a.isDate(b))return new Date(b.valueOf());else if(a.isFunction(b.clone))return b.clone();var d;if(a.isArray(b))d=Array.prototype.slice.call(b);else if(b.constructor!=={}.constructor)return b;else d=a.extend({},b);if(!a.isUndefined(c)&&c>0)for(var e in d)d[e]=a.deepClone(d[e],c-1);return d};a.isConstructor=function(b){return a.isFunction(b)&&b.name};a.resolveConstructor=
function(b){var c=a.isArray(b)?b:a.isString(b)?b.split("."):void 0;if(c)return(b=c.length===1?k[c[0]]:a.keypath(k,c))&&a.isConstructor(b)?b:void 0;else if(a.isFunction(b)&&a.isConstructor(b))return b};a.CONVERT_NONE=0;a.CONVERT_IS_TYPE=1;a.CONVERT_TO_METHOD=2;a.conversionPath=function(b,c){var d=a.isArray(c)?c:a.isString(c)?c.split("."):void 0,e=typeof b,g=d?d[d.length-1]:void 0;if(d&&e===g)return a.CONVERT_IS_TYPE;if((d=a.resolveConstructor(d?d:c))&&e=="object")try{if(b instanceof d)return a.CONVERT_IS_TYPE}catch(f){}g=
d&&d.name?d.name:g;if(!g)return a.CONVERT_NONE;if(a["is"+g]&&a["is"+g](b))return a.CONVERT_IS_TYPE;else if(e=="object"&&b["to"+g])return a.CONVERT_TO_METHOD;return a.CONVERT_NONE};a.isConvertible=function(b,c){return a.conversionPath(b,c)>0};a.toType=function(b,c){var d=a.isArray(c)?c:a.isString(c)?c.split("."):void 0;switch(a.conversionPath(b,d?d:c)){case 1:return b;case 2:return d?b["to"+d[d.length-1]]():(d=a.resolveConstructor(c))&&d.name?b["to"+d.name]():void 0}};a.functionExists=function(b,c){return b instanceof
Object&&b[c]&&a.isFunction(b[c])};a.callIfExists=function(b,c){return a.functionExists(b,c)?b[c].apply(b,Array.prototype.slice.call(arguments,2)):void 0};a.getSuperFunction=function(b,c){var d=a.keypathValueOwner(b,["constructor","__super__",c]);return d&&a.isFunction(d[c])?d[c]:void 0};a.superCall=function(b,c){return a.superApply(b,c,Array.prototype.slice.call(arguments,2))};a.superApply=function(b,c,d){return(c=a.getSuperFunction(b,c))?c.apply(b,d):void 0};a.classOf=function(a){return a!=null&&
Object.getPrototypeOf(Object(a)).constructor.name||void 0};a.copyProperties=function(b,c,d,e){for(var g=d||a.keys(c),f=!1,j=0,h=g.length;j<h;j++)d=g[j],hasOwnProperty.call(c,d)&&(b[d]=c[d],f=!0,e&&delete c[d]);return f};a.getValue=function(a,c,d,e){if(hasOwnProperty.call(a,c)){if(!e)return a[c];d=a[c];delete a[c]}return d};a.sortBy=function(b,c,d){return a.pluck(a.map(b,function(a,b,f){return{value:a,criteria:c.call(d,a,b,f)}}).sort(function(b,c){return a.compare(b.criteria,c.criteria)}),"value")};
a.sortedIndex=function(b,c,d){d||(d=a.identity);for(var e=0,g=b.length;e<g;){var f=e+g>>1;a.compare(d(b[f]),d(c))==a.COMPARE_ASCENDING?e=f+1:g=f}return e};a.COMPARE_EQUAL=0;a.COMPARE_ASCENDING=-1;a.COMPARE_DESCENDING=1;a.compare=function(b,c,d){if(typeof b!=="object")return b===c?a.COMPARE_EQUAL:b<c?a.COMPARE_ASCENDING:a.COMPARE_DESCENDING;d||(d="compare");if(b[d]&&a.isFunction(b[d]))return b=b[d](c),b===0?a.COMPARE_EQUAL:b<0?a.COMPARE_ASCENDING:a.COMPARE_DESCENDING;else if(c[d]&&a.isFunction(c[d]))return b=
c[d](b),b===0?a.COMPARE_EQUAL:b<0?a.COMPARE_DESCENDING:a.COMPARE_ASCENDING;return b===c?a.COMPARE_EQUAL:b<c?a.COMPARE_ASCENDING:a.COMPARE_DESCENDING};a.mixin({AWESOMENESS:a.AWESOMENESS,pluck:a.pluck,remove:a.remove,findIndex:a.findIndex,hasKeypath:a.hasKeypath,keypathExists:a.keypathExists,keypathValueOwner:a.keypathValueOwner,keypath:a.keypath,cloneToDepth:a.cloneToDepth,clone:a.clone,isConstructor:a.isConstructor,resolveConstructor:a.resolveConstructor,CONVERT_NONE:a.CONVERT_NONE,CONVERT_IS_TYPE:a.CONVERT_IS_TYPE,
CONVERT_TO_METHOD:a.CONVERT_TO_METHOD,conversionPath:a.conversionPath,isConvertible:a.isConvertible,conversionPath:a.conversionPath,toType:a.toType,functionExists:a.functionExists,callIfExists:a.callIfExists,getSuperFunction:a.getSuperFunction,superCall:a.superCall,superApply:a.superApply,classOf:a.classOf,copyProperties:a.copyProperties,getValue:a.getValue,COMPARE_EQUAL:a.COMPARE_EQUAL,COMPARE_ASCENDING:a.COMPARE_ASCENDING,COMPARE_DESCENDING:a.COMPARE_DESCENDING,compare:a.compare})})();
